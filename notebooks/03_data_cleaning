from sklearn.preprocessing import LabelEncoder
import pandas as pd

def preprocess_data(df):
    
    df_clean = df.copy()
    
    # 1. Remover ID
    df_clean.drop('customerID', axis=1, inplace=True)
    
    # 2. Tratar TotalCharges
    df_clean['TotalCharges'] = pd.to_numeric(df_clean['TotalCharges'], errors='coerce')
    df_clean['TotalCharges'].fillna(df_clean['TotalCharges'].median(), inplace=True)
    
    # 3. Separar variáveis
    binary_cols = []
    multi_cols = []
    
    for col in df_clean.select_dtypes(include=['object']).columns:
        if col != 'Churn':  
            if df_clean[col].nunique() == 2:
                binary_cols.append(col)
            else:
                multi_cols.append(col)
    
    # 4. Aplicar encoding binário
    le = LabelEncoder()
    for col in binary_cols:
        df_clean[col] = le.fit_transform(df_clean[col])
    
    # 5. Aplicar one-hot encoding
    df_clean = pd.get_dummies(df_clean, columns=multi_cols, drop_first=True)
    
    # 6. Encoding do target
    df_clean['Churn'] = le.fit_transform(df_clean['Churn'])
    
    return df_clean

df_processed = preprocess_data(df)
